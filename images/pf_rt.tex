\begin{tikzpicture}
    %probabilistic filter
    \mixednode{(in1)}{(-7, 0)}{node[left] {In}}
    \mixednode{(a1)}{(-6, 1.5)}{node[above] {A}}
    \mixednode{(b1)}{(-4, 1.5)}{node[above] {B}}
    \mixednode{(c1)}{(-4, 0)}{node[below] {C}}
    \mixednode{(out1)}{(-3, 0)}{node[right] {Out}}

    %reset timer
    \mixednode{(in2)}{(-1, 0)}{node[left] {In}}
    \mixednode{(a2)}{(1, 1)}{node[left] {A}}
    \mixednode{(r2)}{(1, 2.2)}{node[above] {Reset}}
    \mixednode{(out2)}{(3, 0)}{node[right] {Timeout}}

    \choice{(in1)}{(a1)}{node [below right] {$x=\mathrm B(1, p)$}}
    \lossysync{(in1)}{(c1)}{}
    \sync{(c1)}{(out1)}{}
    \syncdrain{(b1)}{(c1)}{}
    \filter{(a1)}{(b1)}{node [above=3] {$x=1?$}}

    \choice{(r2)}{(a2)}{node [above right, xshift=0.1cm] {$x=t_{max}$}}
    \ptimer{(in2)}{(a2)}{(out2)}{}

    \component{(-7, -0.6)}{(-3, 2.2)}{}
    \component{(-1, -0.6)}{(3, 2.2)}{}

\end{tikzpicture}
